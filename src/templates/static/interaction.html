{% extends "base.html" %}

{% block title %}Interaction{% endblock %}

{% block content %}
<style>
    .color-btn {
        width: 60px;
        height: 60px;
        border: none;
        border-radius: 5px;
        margin: 5px;
        cursor: pointer;
        opacity: 0.6;
        transition: opacity 0.2s, transform 0.1s;
        color: transparent;
    }
    .color-btn:hover { opacity: 0.8; }
    .color-btn.active { opacity: 1; border: 3px solid #fff; transform: scale(1.1); }
    .btn-red { background-color: #dc322f; }
    .btn-green { background-color: #859900; }
    .btn-blue { background-color: #268bd2; }
    .btn-yellow { background-color: #b58900; }

    .interaction-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }
    .panel {
        background: #073642;
        padding: 20px;
        border-radius: 5px;
        flex: 1;
        min-width: 300px;
    }
    .room-list-item {
        background: #002b36;
        transition: background 0.2s;
    }
    .room-list-item:hover {
        background: #073642;
    }
    input[type="text"], input[type="number"], input[type="password"], select {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        background: #002b36;
        border: 1px solid #586e75;
        color: #93a1a1;
    }
</style>

<div id="main-container">
    <div class="header">
        <h1>Real-time Interaction</h1>
        <p>Create a room or join an existing one.</p>
    </div>

    <div class="interaction-container">
        <div class="panel">
            <h2>Create New Room</h2>
            <form hx-post="/interaction/create" hx-target="#main-container">
                <label>Username</label>
                <input type="text" name="username" placeholder="Enter your name" required>

                <label>Role</label>
                <select name="role">
                    <option value="controller">Controller (Control colors)</option>
                    <option value="doer">Doer (Watch colors)</option>
                </select>

                <label>Max Controllers</label>
                <input type="number" name="max_controllers" value="5" min="1" max="50">

                <label>Max Doers</label>
                <input type="number" name="max_doers" value="20" min="1" max="100">

                <label>Password (Optional)</label>
                <input type="password" name="password" placeholder="Leave empty for public room">

                <button type="submit" style="width: 100%; margin-top: 10px;">Create Room</button>
            </form>
        </div>

        <div class="panel">
            <h2>Join Existing Room</h2>
            <div style="margin-bottom: 15px;">
                <label>Username</label>
                <input type="text" id="join-username" name="username" placeholder="Enter your name" 
                       hx-get="/interaction/list/controller" 
                       hx-trigger="keyup changed delay:500ms, load" 
                       hx-target="#room-list-container"
                       hx-include="[name='role-filter']"
                       required>
                
                <label>Filter by Role</label>
                <select name="role-filter" 
                        hx-get="/interaction/list/ignore" 
                        hx-target="#room-list-container"
                        hx-trigger="change"
                        onchange="
                            let val = this.value; 
                            let user = document.getElementById('join-username').value;
                            htmx.ajax('GET', '/interaction/list/' + val + '?username=' + encodeURIComponent(user), '#room-list-container');
                        ">
                    <option value="controller">Join as Controller</option>
                    <option value="doer">Join as Doer</option>
                </select>
            </div>

            <div id="room-list-container">
                <p>Loading rooms...</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
